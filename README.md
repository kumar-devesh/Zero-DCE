# Zero-DCE

This repository contains the implementation of the CVPR 2020 paper: *Zero-Reference Deep Curve Estimation for Low-Light Image Enhancement* in PyTorch.

Link: [Zero-Reference Deep Curve Estimation for Low-Light Image Enhancement](https://arxiv.org/abs/2001.06826)

## Setup instructions

- Download or clone the repo and upload it to google drive.
- Run the cells in the dataset notebook to download the Low-Light images dataset and unzip it.
- Run the cells of the Zero-DCE notebook to train the model or to load the saved model weights in the checkpoints directory.

## Overview

The paper presents a novel approach Zero-Reference Deep Curve Estimation (Zero-DCE), which formulates light enhancement as a task of image-specific curve estimation with a deep network DCE-Net. The curve estimation is designed, considering pixel value range, monotonicity, and differentiability. **It does not require any paired data during training**. This is achieved through a set of carefully formulated **non-reference loss functions**, which implicitly measure the enhancement quality and drive the learning of the network.

![](https://user-images.githubusercontent.com/76114246/144811423-491eab57-a418-4931-8f42-3ba328ac24d0.png)
*Visual comparison for the generated enhanced image and the lowlight image.*

## Architecture

![](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/architecture.png)
*The framework of Zero-DCE:  A DCE-Net is devised to estimate a set of best-fitting Light-Enhancement curves that iteratively enhance a given input image.*

The DCE-Net model learns a mapping between the input image and its best-fitting curve parameter maps. The input to the DCE-Net is a low-light image while the outputs are a set of pixel-wise curve parameter maps for corresponding higher-order curves. The model uses CNN layers with 3*3 filters followed by ReLU with symmetric concatenation of the feature maps. 

Batch normalization layers or downsampling are discarded as they break the relations of neighboring pixels.

Similar to curve adjustment used in [photo editing](https://helpx.adobe.com/photoshop/using/curves-adjustment.html) a curve is designed with self adaptive parameters which depend only on the input image with the objectives:

- each pixel value of the enhanced image should be in the normalized range of [0,1] to avoid information loss induced by overflow truncation.
- The curve should be monotonous to preserve the contrast of neighboring pixels.
- the curve should be differentiable in the process of gradient backpropagation.

![](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/equation.png)

*Light enhancement curve which satisfies the required properties.*

## Non Reference Loss Functions

### Spatial Consistency Loss

The *spatial consistency loss* preserves the spatial coherence in enhanced images by preserving the difference between neighboring local regions across the input image and its enhanced version.

### Illumination Smoothness Loss

To preserve the monotonicity relations between neighboring pixels, the *illumination smoothness loss* is added to each curve parameter map.

### Exposure Control Loss

To restrain under or over-exposed regions an exposure control loss is used which measures the distance between the average intensity value of a local
region to the well-exposedness level E (set to 0.6).

### **Color constancy loss**

The *color constancy loss* is used to correct the potential color deviations in the enhanced image.

## Results
| lowlight images | enhanced images|
|----------|-----------|
| ![images_1.PNG](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/results/images_1.PNG) | ![enhanced_images_1.PNG](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/results/enhanced_images_1.PNG) |
| ![images_2.PNG](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/results/images_2.PNG) | ![enhanced_images_2.PNG](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/results/enhanced_images_2.PNG) |
| ![images_3.PNG](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/results/images_3.PNG) | ![enhanced_images_3.PNG](https://github.com/kumar-devesh/Zero-DCE/blob/master/images/results/enhanced_images_3.PNG) |

*Lowlight images and their corresponding enhanced images generated by the trained model.*

### Ablation Results

Contributions of the individual loss functions can be studied by training with different combinations of loss functions. 

<img src="https://github.com/kumar-devesh/Zero-DCE/blob/master/images/ablation%20results/wo%20ec%20loss.PNG" align="center" height="115" width="425" >

Without the *exposure control loss* the model fails in recovering low light regions in the image.

<img src="https://github.com/kumar-devesh/Zero-DCE/blob/master/images/ablation%20results/wo%20cc%20loss.PNG" align="center" height="120" width="450" >

Without the *color constancy loss* tints of a particular color appear in the generated images.

<img src="https://github.com/kumar-devesh/Zero-DCE/blob/master/images/ablation%20results/wo%20is%20loss.png" align="center" height="120" width="450" >

Without the *illumination smoothness loss*, the correlations between neighboring regions are not captured completely.

<img src="https://github.com/kumar-devesh/Zero-DCE/blob/master/images/ablation%20results/wo%20sc%20loss.png" align="center" height="120" width="450" >

Without the *spatial consistency loss*, the images tend to have low contrast than the images with the complete loss function.
